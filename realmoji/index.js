(function(f,u,h){"use strict";const l=[],{getCustomEmojiById:y}=u.findByStoreName("EmojiStore"),g=u.findByName("RowManager"),c=/https:\/\/cdn.discordapp.com\/emojis\/(\d+)\.\w+(?:\?[^\s]*)?/;l.push(h.before("generate",g.prototype,([n])=>{if(n.rowType!==1)return;let e=n.message.content;if(!e?.length)return;const r=e.match(c)?.index;if(r===void 0)return;const s=e.slice(r).trim().split(`
`);if(!s.every(o=>o.match(c)))return;for(e=e.slice(0,r);e.indexOf("  ")!==-1;)e=e.replace("  ",` ${s.shift()} `);e=e.trim(),s.length&&(e+=` ${s.join(" ")}`);const t=n.message.embeds;for(let o=0;o<t.length;o++){const i=t[o];i.type==="image"&&i.url.match(c)&&t.splice(o--,1)}n.message.content=e,n.__realmoji=!0})),l.push(h.after("generate",g.prototype,([n],e)=>{if(n.rowType!==1||n.__realmoji!==!0)return;const{content:r}=e.message;if(!Array.isArray(r))return;const s=r.every(t=>t.type==="link"&&t.target.match(c)||t.type==="text"&&t.content===" ");for(let t=0;t<r.length;t++){const o=r[t];if(o.type!=="link")continue;const i=o.target.match(c);if(!i)continue;const m=i[0],w=m.includes("?")?`${m}&size=128`:`${m}?size=128`;let a;try{const p=new URL(m),b=p.pathname.replace(/\.\w+$/,".webp"),d=new URLSearchParams(p.search);d.set("animated","false"),d.set("size","128"),a=`${p.origin}${b}?${d.toString()}`}catch{a=m.replace(/\.\w+$/,".webp").replace(/([?&])animated=true(&|$)/,"$1animated=false$2"),/size=\d+/.test(a)||(a+=(a.includes("?")?"&":"?")+"size=128")}const j=y(i[1]);r[t]={type:"customEmoji",id:i[1],alt:j?.name??"<realmoji>",src:w,frozenSrc:a,jumboable:s?!0:void 0}}}));const $=()=>l.forEach(n=>n());return f.onUnload=$,f})({},vendetta.metro,vendetta.patcher);
